---
- name: Apply Day 2 Configuration to OCP HCP Cluster
  gather_facts: false
  hosts: localhost
  vars:
# Required Variables for this Playbook
#    type: "LDAP"
#    name: "LDAP3M"
#    cluster_name: hcp-3m
#    url: "ldaps://xxxxxxxxxxxx"
#    bind_password: "xxxxxxxxx"
#    bind_dn: "xxxxxxxxxx"
#    id_attributes: "dn"
#    name_attributes: "cn"
#    email_attributes: "mail"
#    username_attributes: "uid"
#    region: "us-east-1"
#    DEFAULT_3M_SG_ID: "sg-xxxxxxxxxxxxx"
#    VpcId: "xxxxxxx"
#    VpcEndpointId: "xxxxxxxxxx"     
  tasks:
    - name: "OpenShift CLI login"
      shell: "oc login -u {{ cluster_admin_user }} -p {{ cluster_admin_password }} https://api.{{ ocp_cluster_address }}:443 --insecure-skip-tls-verify"

    - include_role:
        name: install_acm
      vars:
        cluster_address: "{{ ocp_cluster_address }}"

    - include_role:
        name: admin_create_acm_service_account
      vars:
        cluster_address: "{{ ocp_cluster_address }}"

    - include_role:
        name: aws_config_security_groups

    # TODO Create Cluster Admin using rosa CLI

    - include_role:
        name: admin_config_ldap

    - include_role:
        name: install_groupsync_from_subscription
      vars:
        cluster_address: "{{ ocp_cluster_address }}"

    - include_role:
        name: admin_config_rbac
      vars:
        cluster_address: "{{ ocp_cluster_address }}"

  # TODO Create trident-csi as default StorageClass (FSXn)
  # TODO Create Machine Pool

    - include_role:
        name: admin_config_log_forwarder
      vars:
        cluster_address: "{{ ocp_cluster_address }}"